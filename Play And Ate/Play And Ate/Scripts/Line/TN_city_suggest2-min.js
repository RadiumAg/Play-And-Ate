(function(a){a.fn.TN_CitySuggest=function(r){r=jQuery.extend({hotCity_W:"TN_HotCity_W",commonCity_W:"TN_CommonCity_W",hotcityArr:null,cmcityArr:null,usecityArr:null,delayTimes:100,pageLen:12},r);var j=this;var o=null;var i=null;var f="";var l=0;var c=0;var k=new Array();var b;var g;function t(){o=a('<div class="TN_hotcity_w" id="'+r.hotCity_W+'"></div>').appendTo("body");o.css({position:"absolute"}).hide();m();i=a('<div class="TN_cmcity_w" id="'+r.commonCity_W+'"></div>').appendTo("body");i.css({position:"absolute"}).hide();o.click(																																																																																																																																					  function(u){a(j).focus();u=u||window.event;u.stopPropagation?u.stopPropagation():u.cancelBubble=true});i.click(function(u){a(j).focus();u=u||window.event;u.stopPropagation?u.stopPropagation():u.cancelBubble=true});document.KeyPreview=false;a(j).click(function(u){u=u||window.event;u.stopPropagation?u.stopPropagation():u.cancelBubble=true});a(j).focus(function(){if(i.is(":hidden")){if(a(this).val()=="\u4e2d\u6587/\u62fc\u97f3"){a(this).val("").css("color","#000")}else{a(this).css("color","#000").select()}i.hide();var u=p(a(this));b=u.left;g=u.top+a(this).outerHeight()+1;o.css({left:b+"px",top:g+"px"}).show(r.delayTimes,function(){a(document).unbind("click",q);a(document).unbind("keydown",q);a(document).click(q);a(document).keydown(q);a(j).keyup(function(){s(a(this).val().trim())});a(j).keydown(function(){f=a(this).val().trim()})})}})}a(window).resize(function(){try{if(o.is(":visible")){var v=p(a(j));b=v.left;g=v.top+a(j).outerHeight()+1;o.css({left:b,top:g})}if(i.is(":visible")){var v=p(a(j));b=v.left;g=v.top+a(j).outerHeight()+1;i.css({left:b,top:g})}}catch(u){}});String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};function m(){var v="";v+='<div class="TN_city_h"><strong>\u70ed\u95e8\u57ce\u5e02</strong><span>\uff08\u53ef\u76f4\u63a5\u8f93\u5165\u57ce\u5e02\u6216\u57ce\u5e02\u62fc\u97f3\uff09</span></div>';v+='<div class="TN_hotcity_div">';var u=r.hotcityArr;for(var w=0;w<u.length;w++){v+=('<a href="javascript:void(0)">'+u[w][1]+"</a>")}v+="</div>";o.html(v);a("#"+r.hotCity_W+" .TN_hotcity_div a").click(function(x){a(j).val(a(this).html());e();o.hide();i.hide();x=x||window.event;x.stopPropagation?x.stopPropagation():x.cancelBubble=true;return false})}function s(w){if(w!=f){var y="";switch(w){case"":i.hide();var B=p(a(j));b=B.left;g=B.top+a(j).outerHeight()+1;o.show().css({left:b,top:g});return;break;default:y+='<div class="TN_city_h" style="width:180px">'+w+"\uff0c\u6309\u62fc\u97f3\u6392\u5e8f\u3000<span>(\u53ef\u2191\u2193\u9009\u62e9)</span></div>";var z=n(w,"en");var D=n(w,"ch");if(z||D){if(z){var C=new Array();var A=r.cmcityArr;var u=0;var v=0;for(var x=0;x<A.length;x++){u=A[x][3].indexOf(w.toUpperCase());v=A[x][2].indexOf(w.toUpperCase());if(u==0||v==0){C.push(A[x])}}if(C.length>0){if(C.length<=r.pageLen){y+='<div class="TN_cmcity_div">';for(var x=0;x<C.length;x++){y+=('<a href="javascript:void(0)"><span>'+C[x][1]+"</span>"+C[x][2]+"</a>")}y+="</div>"}else{for(var x=0;x<C.length;x++){if(x%r.pageLen==0){y+='<div class="TN_cmcity_div">'}y+=('<a href="javascript:void(0)"><span>'+C[x][1]+"</span>"+C[x][2]+"</a>");if((x+1)%r.pageLen==0||(x+1)==C.length){y+="</div>"}}}}else{o.hide();i.hide();E=E||window.event;}}else{var C=new Array();var A=r.cmcityArr;var u=0;for(var x=0;x<A.length;x++){u=A[x][1].indexOf(w);if(u>-1){C.push(A[x])}}if(C.length>0){if(C.length<=r.pageLen){y+='<div class="TN_cmcity_div">';for(var x=0;x<C.length;x++){y+=('<a href="javascript:void(0)"><span>'+C[x][1]+"</span>"+C[x][2]+"</a>")}y+="</div>"}else{for(var x=0;x<C.length;x++){if(x%r.pageLen==0){y+='<div class="TN_cmcity_div">'}y+=('<a href="javascript:void(0)"><span>'+C[x][1]+"</span>"+C[x][2]+"</a>");if((x+1)%r.pageLen==0||(x+1)==C.length){y+="</div>"}}}}else{}}}else{}break}i.html(y);a("#"+r.commonCity_W+" .TN_cmcity_div a").click(function(E){a(j).val(a(this).find("span").eq(0).html());e();o.hide();i.hide();E=E||window.event;E.stopPropagation?E.stopPropagation():E.cancelBubble=true;return false});o.hide();k=i.find(".TN_cmcity_div");if(k.length<=1){a("#"+r.commonCity_W+" .TN_cmcity_div a:first").addClass("csel")}else{l=0;c=k.length;a(k).hide();a(k[l]).find("a:first").addClass("csel");a(k[l]).show();d()}var B=p(a(j));b=B.left;g=B.top+a(j).outerHeight()+1;i.css({left:b+"px",top:g+"px"}).show(r.delayTimes)}}function d(){var v='<div class="TN_cmpagelist">\u3000';for(var w=0;w<k.length;w++){if(w!=l){v+='<a href="javascript:void(0)">'+(w+1).toString()+"</a>\u3000"}else{v+="<span>"+(w+1).toString()+"</span>\u3000"}}v+="</div>";i.find(".TN_cmpagelist").remove();i.append(v);a("#"+r.commonCity_W+" .TN_cmpagelist span").click(function(x){x=x||window.event;x.stopPropagation?x.stopPropagation():x.cancelBubble=true});a("#"+r.commonCity_W+" .TN_cmpagelist a").click(function(x){x=x||window.event;x.stopPropagation?x.stopPropagation():x.cancelBubble=true;h("normal",a(this).html());return false});if(l!=0){var u=a('<a style="font-family:Simsun;font-size:12px" href="javascript:void(0)">&lt;-</a>').prependTo(i.find(".TN_cmpagelist"));u.click(function(x){x=x||window.event;x.stopPropagation?x.stopPropagation():x.cancelBubble=true;h("pre",null);return false})}if(l!=k.length-1){var u=a('<a style="font-family:Simsun;font-size:12px" href="javascript:void(0)">-&gt;</a>').appendTo(i.find(".TN_cmpagelist"));u.click(function(x){x=x||window.event;x.stopPropagation?x.stopPropagation():x.cancelBubble=true;h("next",null);return false})}}function h(u,v){a(k[l]).find("a").removeClass("csel");switch(u){case"normal":l=parseInt(v)-1;break;case"pre":l--;break;case"next":l++;break;default:break}a(k).hide();a(k[l]).find("a:first").addClass("csel");a(k[l]).show();a(j).focus();d()}function n(w,x){var u=false;switch(x){case"en":var v=/^[A-Za-z]+$/;if(v.test(w)){u=true}break;case"ch":var v=/^[\u4E00-\u9FA5]+$/;if(v.test(w)){u=true}break;default:break}return u}function q(u){switch(u.type){case"click":o.hide();i.hide();if(a(j).val()=="\u4e2d\u6587/\u62fc\u97f3"||a(j).val()==""){a(j).val("\u4e2d\u6587/\u62fc\u97f3").css("color","#999")}a(document).unbind("click",q);a(document).unbind("keydown",q);break;case"keydown":switch(u.keyCode){case 9:o.hide();i.hide();if(a(j).val()=="\u4e2d\u6587/\u62fc\u97f3"||a(j).val()==""){a(j).val("\u4e2d\u6587/\u62fc\u97f3").css("color","#999")}a(document).unbind("click",q);a(document).unbind("keydown",q);break;case 38:if(i.is(":visible")){var w=a(k[l]).find(".csel").eq(0);var v=a(k[l]).find("a");if(v.length>1){if(w.prev("a").html()){a(v).removeClass("csel");w.prev("a").addClass("csel")}else{a(v).removeClass("csel");a(v).eq(v.length-1).addClass("csel")}}}break;case 40:if(i.is(":visible")){var w=a(k[l]).find(".csel").eq(0);var v=a(k[l]).find("a");if(v.length>1){if(w.next("a").html()){w.removeClass("csel");w.next("a").addClass("csel")}else{a(v).removeClass("csel");a(v).eq(0).addClass("csel")}}}break;case 13:if(i.is(":visible")){var w=a(k[l]).find(".csel").eq(0);a(j).val(w.find("span").eq(0).html());e();o.hide();i.hide();a(j).blur();a(document).unbind("click",q);a(document).unbind("keydown",q)}break;default:break}break;default:break}}function e(){if(a("#hotel_name").length>0){a("#hotel_name").val("\u9152\u5e97\u5173\u952e\u8bcd").css({color:"#999"})}if(a("#business_park").length>0){a("#business_park").val("\u8857\u9053/\u5730\u6807").css({color:"#999"})}if(a("#business_park_id").length>0){a("#business_park_id").val("0")}}function p(v){var u=v.offset();return u}t()}})(jQuery);
